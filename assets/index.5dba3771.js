var X=Object.defineProperty,ee=Object.defineProperties;var te=Object.getOwnPropertyDescriptors;var P=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var I=(t,s,e)=>s in t?X(t,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[s]=e,A=(t,s)=>{for(var e in s||(s={}))se.call(s,e)&&I(t,e,s[e]);if(P)for(var e of P(s))ae.call(s,e)&&I(t,e,s[e]);return t},B=(t,s)=>ee(t,te(s));import{f as ne,S as p,H as oe,h as N,b as f,Z as ie,u as V,$ as L,a as D,a0 as H,t as T,k as z,a1 as G,C as j,d as C,a2 as ce,a3 as re,a4 as le,a5 as ue,a6 as R,a7 as de}from"./pages.c22eb3e2.js";import{G as S,v as a,H as Y,e as o,x as _,P as O}from"./app.2b9af6ff.js";import{u as me}from"./useOverview.27651526.js";import{u as Q}from"./getNumber.7d417956.js";import{f as W,u as Z,T as q}from"./TxBroadcastingModal.26480363.js";import{C as pe,T as J}from"./TxSimulationResult.6ba058be.js";import"./index.148ce3f4.js";import"./Tooltip.94e8fff6.js";const he={name:"mmvz9h",styles:"font-weight:400"},Se=()=>{const{isLoading:t,data:{priceInUst:s=0}={}}=me();return S(Y,{children:[a(ne,{children:"Trade $MINE"}),a(p,{level:40}),a(oe,{children:"$MINE Price"}),a(p,{level:8}),a(N,{css:he,children:`${t?"-":s==null?void 0:s.toLocaleString()} UST`}),a(p,{level:56})]})},K=({from:t,to:s,receivingValue:e,maximumBalance:r,onSync:l})=>{const c=f(),[n,u]=o.exports.useState(0),d=o.exports.useCallback(m=>{u(m)},[]);return o.exports.useEffect(()=>{u(0)},[c,r]),o.exports.useEffect(()=>{l(n)},[n,l]),S(Y,{children:[a(N,{children:"You Pay"}),a(p,{level:16}),a(pe,{symbol:t,maximum:r,onSync:d}),a(p,{level:4}),a(N,{children:"You Receive"}),a(p,{level:16}),a(ie,{type:"number",label:s,placeholder:"0.00",value:e||"",disabled:!0})]})},be=async(t,s,e)=>{try{const[r,l,c]=await Promise.all([await t.mineUST.buy(s,e),await t.mineUST.simulateBuy(e),await W()]),{returnAmount:n,commissionAmount:u}=l,d=Math.round(L()*c),m=new _.exports.Coin("uusd",d);return B(A({},r),{transactionFee:m,received:{unit:"mine",amount:n},minReceived:{unit:"mine",amount:n-u},tradingFee:{unit:"mine",amount:u}})}catch{return}},ye=t=>{var c;const s=D(),e=f(),r=(c=e==null?void 0:e.terraAddress)!=null?c:"",l=!!t&&!!(e!=null&&e.terraAddress);return V(["@trade/buy/simulate-buy",{amount:t}],async()=>await be(s,r,t),{enabled:l,cacheTime:0})},ve=async(t,s,e)=>{try{const[r,l,c]=await Promise.all([await t.mineUST.sell(s,e),await t.mineUST.simulateSell(e),await W()]),{returnAmount:n,commissionAmount:u}=l,d=Math.round(L()*c),m=new _.exports.Coin("uusd",d);return B(A({},r),{transactionFee:m,received:{unit:"ust",amount:n},minReceived:{unit:"ust",amount:n-u},tradingFee:{unit:"ust",amount:u}})}catch{return}},xe=t=>{var c;const s=D(),e=f(),r=(c=e==null?void 0:e.terraAddress)!=null?c:"",l=!!t&&!!(e!=null&&e.terraAddress);return V(["@trade/sell/simulate-sell",{amount:t}],async()=>await ve(s,r,t),{enabled:l,cacheTime:0})},fe=()=>{const t=f(),{ust:s}=O(H),[e,r]=o.exports.useState(0),[l,c]=o.exports.useState(0),[n,u]=o.exports.useState(void 0),d=Q(e,300),m=o.exports.useMemo(()=>Math.max(T(s,3)-1,0),[s]),{isFetching:M,isFetched:w,data:i}=ye(d),{isTransacting:b,send:x}=Z(),E=o.exports.useCallback(()=>{u(void 0),r(0)},[]),$=o.exports.useCallback(y=>{r(y)},[]),F=async()=>{if(i){const h={action:`Swap ${e.toLocaleString()} UST for ${T(i.received.amount,3).toLocaleString()} MINE`},v=await x(i.transactions,h);if(!(v!=null&&v.payload))return;u(v.payload)}};return o.exports.useEffect(()=>{c(0)},[t]),o.exports.useEffect(()=>{var y;c((y=i==null?void 0:i.received.amount)!=null?y:0)},[i]),S(j,{children:[a(K,{from:"UST",to:"MINE",receivingValue:l,maximumBalance:m,onSync:$}),a(p,{level:40}),w&&a(J,{data:i}),a(G,{intent:"primary",size:"large",disabled:!e||!i||M||b,onClick:F,children:b?a(z,{color:"#000000"}):"Buy $MINE"}),!!n&&a(q,{isTransacting:b,type:n!=null&&n.success?"success":"failure",details:n,onClose:E})]})},ge=()=>{const t=f(),{mine:s}=O(H),[e,r]=o.exports.useState(0),[l,c]=o.exports.useState(0),[n,u]=o.exports.useState(void 0),d=Q(e,300),m=o.exports.useMemo(()=>Math.max(T(s,3),0),[s]),{isFetching:M,isFetched:w,data:i,remove:b}=xe(d),{isTransacting:x,send:E}=Z(),$=o.exports.useCallback(()=>{u(void 0),b()},[b]),F=o.exports.useCallback(h=>{r(h)},[]),k=async()=>{if(i){const v={action:`Swap ${e.toLocaleString()} MINE for ${T(i.received.amount,3).toLocaleString()} UST`},g=await E(i.transactions,v);if(!(g!=null&&g.payload))return;u(g.payload)}};return o.exports.useEffect(()=>{c(0)},[t]),o.exports.useEffect(()=>{var h;c((h=i==null?void 0:i.received.amount)!=null?h:0)},[i]),S(j,{children:[a(K,{from:"MINE",to:"UST",receivingValue:l,maximumBalance:m,onSync:F}),a(p,{level:40}),w&&a(J,{data:i}),a(G,{intent:"secondary",size:"large",disabled:!e||!i||M||x,onClick:k,children:x?a(z,{}):"Sell $MINE"}),!!n&&a(q,{isTransacting:x,type:n!=null&&n.success?"success":"failure",details:n,onClose:$})]})},Te=C("div",{target:"e16nc4sm3"})({name:"mb6hab",styles:"display:grid;grid-template-columns:[left] 360px [main];gap:48px;margin:0 auto;@media all and (max-width: 960px){display:block;}"}),Ce=C("div",{target:"e16nc4sm2"})({name:"1cgc7zm",styles:"grid-column:left/main"}),Me=C("div",{target:"e16nc4sm1"})({name:"1lg8d8o",styles:"grid-column:main/end"}),we=C("section",{target:"e16nc4sm0"})({name:"6mg1so",styles:"max-width:512px"}),U=[{tab:"buy",name:"Buy",component:fe},{tab:"sell",name:"Sell",component:ge}],Ee=()=>S(Te,{children:[a(Ce,{children:a(Se,{})}),S(Me,{children:[a(le,{children:U.map(({tab:t,name:s})=>a(ce,{className:({isActive:e})=>e?"on":void 0,to:`${t}`,children:a(re,{children:s})},t))}),a(we,{children:S(ue,{children:[U.map(({tab:t,component:s})=>a(R,{element:a(s,{}),path:`${t}`},t)),a(R,{path:"*",element:a(de,{to:"buy"})})]})})]})]});var Ue=Ee;export{Ue as default};
